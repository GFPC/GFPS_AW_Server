## API v1

### Пользователи (Users)

- POST `/api/1/manager/workers`
  - Тело запроса (JSON):
    - `token` — ibronevik auth
    - `u_hash` — ibronevik auth
    - `team_id` - ВРЕМЕННО (int) — ID команды
  - Действие: возвращаются все сотрудники указанной команды
  - team_id можно подставлять любой, доступно лишь на этапе разработки, после чего данное поле будет удалено
  - Ответ: `application/json`

#### Пример ответа

```json
{
  "status": "success",
  "data": {
    "workers": [
      {
        "id": 1,
        "username": "user1",
        "uuid": "user-uuid-123",
        "created": "2025-02-26T08:59:00+00:00",
        "data": {}
      },
      {
        "id": 2,
        "username": "user2",
        "uuid": "user-uuid-456",
        "created": "2025-02-26T09:15:00+00:00",
        "data": {}
      }
    ]
  }
}
```

#### Формат ответа (структура)

```json
{
  "status": "success | error",
  "data": {
    "workers": [
      {
        "id": "int",
        "username": "string",
        "uuid": "string",
        "created": "string",        // ISO 8601, UTC
        "data": "object"            // произвольные данные пользователя
      }
    ]
  }
}
```

### Букеты (Buckets)

- POST `/api/1/manager/buckets`
  - Тело запроса (JSON):
    - `users` (array<int>, или array<string>, или "all", обязателен) — список ID пользователей
      - когда =all, возвращаются букеты для всех сотрудников команды
    - `token` — ibronevik auth
    - `u_hash` — ibronevik auth
  - Действие: возвращаются букеты для указанных пользователей
  - Ответ: `application/json`

#### Пример ответа

```json
{
  "status": "success",
  "data": {
    "buckets": {
      "1": {
        "aaeaaeaaeaaaeaaeaae": {
          "id": "0",
          "created": "2025-02-26T08:59:00+00:00",
          "type": "aaa",
          "client": "aaa",
          "hostname": "aaa",
          "data": {}
        }
      },
      "2": {},
      "3": {}
    }
  }
}
```

#### Формат ответа (структура)

```json
{
  "status": "success | error",
  "data": {
    "buckets": {
      "<userId>": {
        "<bucketHashKey>": {
          "id": "string",
          "created": "string",
          "type": "string",
          "client": "string",
          "hostname": "string",
          "data": "object"
        }
      }
    }
  }
}
```


### События(Events)

- POST `/api/1/manager/buckets/events`
  - Тело:
    - `buckets` — (array<string>, обязателен) список хеш-ключей букетов
    - `limit` — (int, необязателен) количество событий на каждый букет; по умолчанию без лимита
    - `start` — (string, ISO 8601, необязателен) нижняя граница по времени
    - `end` — (string, ISO 8601, необязателен) верхняя граница по времени
    - `token` — ibronevik auth
    - `u_hash` — ibronevik auth
  - Действие:
    - Возвращаются события для указанных букетов. `start`/`end` принимаются с любой временной зоной и приводятся к UTC на сервере. Пример:
```json
{
  "status": "success",
  "data": {
    "events": {
      "aaeaaeaaeaaaeaaeaae": [
        {
          "id": 0,
          "timestamp": "2360-02-29T17:15:12+00:00",
          "duration": 56.0,
          "data": {}
        }
      ]
    }
  }
}
```
Формат:
```json
{
  "status": "success | error",
  "data": {
    "events": {
      "<bucketHashKey>": [
        {
          "id": "int",
          "timestamp": "string",
          "duration": "float",
          "data": "object"
        }
      ]
    }
  }
}
```

#### Параметры времени и TZ

- Поля `start` и `end` принимают строки в ISO 8601, например: `"2025-10-13 14:35:25+07:00"`.
- Сервер конвертирует любую указанную TZ в UTC перед фильтрацией.
- Микросекунды нормализуются к миллисекундам; верхняя граница включает следующий миллисекундный тик.

### Подсчет количества событий

- POST `/api/1/manager/buckets/events/count`
  - Тело:
    - `buckets` — (array<string>, обязателен) список хеш-ключей букетов
    - `token`, `u_hash` — ibronevik auth
  - Действие: возвращает количество событий по каждому хеш-ключу
  - Ответ (пример):
```json
{
  "status": "success | error",
  "data": {
    
  }
}
```

### Общие правила

- Все временные значения в ответах возвращаются в формате ISO 8601 и в UTC.
- Текстовые JSON-поля в данных событий/бакетов/пользователей хранятся и передаются в UTF‑8; допускаются любые Unicode-символы.
- В случае ошибки авторизации на bronevik возвращается `{ "status": "error", "message": "unauthorized access" }`.
- Content-Type: application/json

### Подсказки по интеграции
- Есть более широки функционал для фильтровки event(по категориям и тп) - это метод /api/0/query
 с ним можно ознакомиться лишь на живом примере в программе ActivityWatch.
- Шаги по установке:
1. Установить ActivityWatch
2. Зайти в `Настройки` и в поле `IP` раздела `GFPS` вставить полученый IP, а в `PORT` 5700 и затем нажать сохранить
3. После этих действий можно будет видеть как фронт общается с бэком через query
- Пример содержимого настроек можно найти в файле C:\Users\XXX\AppData\Local\activitywatch\activitywatch\aw-server\settings.json, где XXX - имя пользователя windows 10/11
- Код фронта доступен по ссылке https://github.com/GFPC/AWClient
- Пример ссылки на бэк http://ip:port/api/1/manager/workers